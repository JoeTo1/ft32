<!DOCTYPE html>
<html lang="de">
	<head>
        <link rel="stylesheet" href="stylesheet.css">
	    <meta charset="utf-8"/>
	    <title>ESP IDE</title>
	</head>	
	<xml id="toolbox" style="display: none">
        <category name="Basic">
            <block type="start"></block>
        </category>
        <category name="Logic">
            <block type="math_number"></block>
			<block type="digital_logic_compare"></block>
			<block type="analog_logic_compare"></block>
        </category>
        
        <category name="Actuator">
            <block type="motor"></block>
            <block type="lamp"></block>
        </category>        
        <category name="Loops">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <block type="math_number">
                        <field name="NUM">10</field>
                    </block>
                </value>
            </block>
            <block type="controls_whileuntil1"></block>
        </category>        
        <category name="Branching">
            <block type="controls_if1"></block>
        </category>
        
        <category name="Delay">
            <block type="wait"></block>
        </category>        
        <category name="Debuging">
            <block type="text_print">
                <value name="TEXT">
                    <block type="text">
                        <field name="TEXT">message</field>
                    </block>
                </value>
            </block>
        </category>
        <category name="Examples">
            <block type="start">
                <value name="state">
                    <block type="controls_repeat_ext">
                        <value name="TIMES">
                            <block type="math_number">
                                <field name="NUM">10</field>
                            </block>                           
                        </value>
                        <statement name="DO">
                            <block type="motor">
                                <field name="motorNumber">M1</field>
                                <field name="motorSpeed">5</field>
                                <next>
                                    <block type="wait">
                                        <field name="seconds">5</field>
                                        <next>
                                            <block type="lamp">
                                                <field name="lampNumber">L2</field>
                                                <field name="state">on</field>
                                                <next>
                                                    <block type="motor">
                                                        <field name="motorNumber">M1</field>
                                                        <field name="motorSpeed">5</field>
                                                        <field name="motorDirection">right</field>
                                                        <next>
                                                            <block type="wait">
                                                                <field name="seconds">5</field>
                                                                <next>
                                                                    <block type="lamp">
                                                                        <field name="lampNumber">L2</field>
                                                                        <field name="state">off</field> 
                                                                    </block>
                                                                </next>
                                                            </block>
                                                        </next>                                                        
                                                    </block>    
                                                </next>
                                            </block>
                                        </next>
                                    </block>
                                </next>                                
                            </block>                                                     
                        </statement>
                    </block>
                                     
                </value> 
            </block>       
        </category>
    </xml>		
	<body>
		<main>
		    <div class=loadingscreen id=screen> 
		        <div class=screencontent>
	                <p>Loading content ...</p>     
                    <div class=spinner id=loader>               
                        <span></span>
                        <span></span>
                        <span></span>     
                    </div>
                </div>            
            </div>
            <div class=content id="cont">
                <div class=clabel>
                    <p>&#169; Copyright 2017, T. Tr&auml;nkel, F.J. Pal</p>
                </div>
                <div class=header>ESP IDE v0.1</div>
                <div class=ide>
                    <div class=editor>
                        <div id="blocklyDiv"></div>
                    </div>
                    <div class=console>
					
					<div class="dropdown-bar">					
					Language:
					<div id="im-just-an-underline">
						<select id="languageDropdown" onchange="myUpdateFunction();">
							<option value="JavaScript">Basic</option>
							<option value="Dart">C++</option>
							<option value="Lua">Interner Code</option>
						</select>
					</div>
					</div>
                       
					   <pre id=textoutput></pre>
	
                        <div class=play-button onClick=playButtonPressed()>
                            <div></div>
                        </div>
                        <div class=send-button onClick=sendButtonPressed()>
                            <div>&#10143;</div>
                        </div>
                    </div>
                </div> 
            </div>
		</main>	
	</body>
	<script src="blockly_compressed.js"></script>
	<script src="custom_blocks.js"></script>
    <script src="blocks_compressed.js"></script>	
	<script src="javascript.js"></script> <!-- to DO: INCLUDE!!!!!!!!!!!!!!!!!!!!-->
    <script src="lua.js"></script>
	<script src="dart.js"></script>
    <script src="math.js"></script>
	<script src="logic.js"></script>
	<script src="loops.js"></script>
	<script src="text.js"></script>	
    <script src="en.js"></script>
    <script src="custom_blocks_syntax.js"></script>
    <script src="dummy.js"></script>    
    <script>
        var workspace = Blockly.inject('blocklyDiv',
            {toolbox: document.getElementById('toolbox'),
             zoom:
                {controls: true,
                 wheel: true,
                 startScale: 1.0,
                 maxScale: 3,
                 minScale: 0.3,
                 scaleSpeed: 1.2},
             trashcan: true});          
        /*
		function myUpdateFunction(event) {
            resetLogicCounterVar();
            resetLoopsCounterVar();
			
            var code = Blockly.Lua.workspaceToCode(workspace);
            document.getElementById("textoutput").innerHTML = code;
        }
		*/
		function myUpdateFunction(event) {
    var languageDropdown = document.getElementById('languageDropdown');
    var languageSelection = languageDropdown.options[languageDropdown.selectedIndex].value;
    resetLogicCounterVar();
    resetLoopsCounterVar();
	//var codeDiv = document.getElementById('codeDiv');
    //var codeHolder = document.createElement('pre');
    //codeHolder.className = 'prettyprint but-not-that-pretty';
    var code = Blockly[languageSelection].workspaceToCode(workspace);
    document.getElementById("textoutput").innerHTML = code;
	//codeHolder.appendChild(code);
    //codeDiv.replaceChild(codeHolder, codeDiv.lastElementChild);
    //PR.prettyPrint();
  }
		
		
		
        workspace.addChangeListener(myUpdateFunction);        
        function playButtonPressed() {
            alert('Play Button pressed');
        }        
        function sendButtonPressed() {
            alert('Send Button pressed');
        }
    </script>
    <script>
        //document.getElementById('cont').style.display = "none";
        window.onload = function () {
            console.log('Content loaded.');
            document.getElementById('screen').classList.add('hide');
            setTimeout(function() { document.getElementById('screen').style.display = "none"; }, 1000);            
            setTimeout(function() { document.getElementById('cont').classList.add('show'); }, 1000); 
            //document.getElementById('cont').style.display = "block";          
        }
    </script>
</html>
